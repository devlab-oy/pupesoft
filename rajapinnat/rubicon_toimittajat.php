<?php

if (php_sapi_name() != 'cli') {
  die('clionly!');
}

if (!isset($argv[1])) {
  echo "Anna Puperoot\n";
  exit(1);
}

$pupesoft_root = $argv[1];

if (!is_dir($pupesoft_root) or !is_file("{$pupesoft_root}/inc/salasanat.php")) {
  echo "Pupesoft root missing!";
  exit(1);
}

// Pupesoft root include_pathiin
ini_set("include_path", ini_get("include_path").PATH_SEPARATOR.$pupesoft_root);

// Otetaan tietokanta connect
require "inc/connect.inc";
require "inc/functions.inc";

// Logitetaan ajo
cron_log();

// Tämä vaatii paljon muistia
error_reporting(E_ALL);
ini_set("memory_limit", "5G");
ini_set("display_errors", 1);
unset($pupe_query_debug);

/*
X = siirretään relaatioineen
P = siirretään relaatioineen ja laitetaan poistotilaan
E = vain relaatiot tuodaan

X  ei tapahtumia 2012 jälkeen
E  ei tuoda
E  ei tuoda toimittajaa
E  poistetaan
E  poistettu
P  poistettu tilaan
X  toimittaja ja avoimet laskut tuodaan
X  toimittaja ja tapahtumat tuodaan
X  toimittaja sekä avoimet laskut tuodaan
X  toimittaja sekä avoimet tapahtumat tuodaan
X  toimittaja tuodaan, myös avoimet laskut
E  toimittajaa ei tuoda
E  toimittajaa ei tuoda
E  toimittajaa ei tuoda, mutta avoimet laskut on saatava, jos niitä on
X  tuodaan toimittaja ja tapahtumat
X  tuodaan, samoin mahdolliset avoimet laskut
*/

// R Pellon ja Sampsan lista toimittajista Mas => Örum (avoimia laskuja ei kuitenkaan tuoda)
$toimikonversio = array(
  '26757' => 'E',
  '31526' => 'E',
  '31825' => 'X',
  '31521' => 'E',
  '31774' => 'X',
  '32017' => 'X',
  '26798' => 'X',
  '31042' => 'E',
  '32009' => 'X',
  '30993' => 'X',
  '30910' => 'E',
  '30891' => 'E',
  '32036' => 'X',
  '30707' => 'X',
  '32042' => 'X',
  '32432' => 'X',
  '30941' => 'E',
  '32310' => 'X',
  '31630' => 'X',
  '27023' => 'X',
  '26797' => 'X',
  '30783' => 'X',
  '26911' => 'E',
  '30855' => 'X',
  '30857' => 'E',
  '30965' => 'X',
  '27021' => 'X',
  '31184' => 'E',
  '27271' => 'X',
  '32545' => 'X',
  '32509' => 'E',
  '26792' => 'X',
  '26785' => 'X',
  '30900' => 'X',
  '32047' => 'X',
  '32093' => 'X',
  '31457' => 'X',
  '31137' => 'E',
  '31269' => 'E',
  '32398' => 'X',
  '31331' => 'X',
  '31426' => 'X',
  '31479' => 'X',
  '32239' => 'X',
  '31371' => 'X',
  '31487' => 'X',
  '30788' => 'E',
  '32215' => 'X',
  '30927' => 'X',
  '32529' => 'X',
  '32098' => 'X',
  '30656' => 'E',
  '31847' => 'X',
  '31492' => 'X',
  '31687' => 'X',
  '31232' => 'E',
  '31003' => 'X',
  '26815' => 'X',
  '27484' => 'X',
  '32345' => 'E',
  '31036' => 'X',
  '31196' => 'X',
  '32037' => 'X',
  '31809' => 'X',
  '31926' => 'X',
  '31891' => 'X',
  '31425' => 'X',
  '32297' => 'X',
  '31991' => 'X',
  '32305' => 'E',
  '31801' => 'X',
  '32463' => 'X',
  '30853' => 'E',
  '30848' => 'E',
  '30372' => 'X',
  '27389' => 'X',
  '32050' => 'X',
  '30825' => 'X',
  '31132' => 'X',
  '32284' => 'X',
  '30636' => 'X',
  '31511' => 'X',
  '32126' => 'E',
  '31035' => 'E',
  '31432' => 'X',
  '32455' => 'X',
  '32767' => 'X',
  '32724' => 'X',
  '32135' => 'X',
  '30801' => 'E',
  '32160' => 'X',
  '31470' => 'X',
  '31067' => 'X',
  '30871' => 'X',
  '31323' => 'E',
  '30585' => 'X',
  '32190' => 'X',
  '32381' => 'X',
  '32718' => 'X',
  '31452' => 'X',
  '31058' => 'X',
  '31655' => 'X',
  '32335' => 'E',
  '30997' => 'X',
  '31734' => 'X',
  '32368' => 'X',
  '30751' => 'X',
  '32205' => 'X',
  '30839' => 'X',
  '30933' => 'X',
  '26788' => 'X',
  '31249' => 'X',
  '27204' => 'X',
  '30648' => 'X',
  '32165' => 'X',
  '31192' => 'X',
  '31529' => 'X',
  '31992' => 'E',
  '30836' => 'E',
  '32230' => 'X',
  '30842' => 'X',
  '31939' => 'X',
  '31740' => 'X',
  '32377' => 'X',
  '32360' => 'X',
  '32481' => 'X',
  '32055' => 'X',
  '32712' => 'X',
  '31305' => 'X',
  '32385' => 'X',
  '31057' => 'X',
  '30688' => 'X',
  '31130' => 'P',
  '31469' => 'X',
  '32626' => 'X',
  '32547' => 'X',
  '32201' => 'X',
  '30631' => 'X',
  '30770' => 'X',
  '31993' => 'X',
  '32107' => 'X',
  '32236' => 'E',
  '32117' => 'X',
  '30793' => 'X',
  '32206' => 'X',
  '32271' => 'E',
  '32513' => 'X',
  '31124' => 'E',
  '30767' => 'X',
  '31795' => 'X',
  '30408' => 'E',
  '30873' => 'X',
  '32220' => 'X',
  '32448' => 'X',
  '27118' => 'X',
  '30728' => 'X',
  '30643' => 'X',
  '32277' => 'X',
  '30841' => 'X',
  '30630' => 'X',
  '32086' => 'X',
  '32137' => 'X',
  '30837' => 'X',
  '30856' => 'X',
  '31218' => 'X',
  '30680' => 'X',
  '30942' => 'X',
  '31600' => 'E',
  '31284' => 'X',
  '31984' => 'E',
  '31925' => 'X',
  '32433' => 'X',
  '31673' => 'X',
  '29456' => 'X',
  '32662' => 'X',
  '32182' => 'X',
  '32278' => 'X',
  '31739' => 'E',
  '31373' => 'X',
  '27504' => 'X',
  '30768' => 'X',
  '31616' => 'X',
  '30908' => 'E',
  '31340' => 'X',
  '26958' => 'E',
  '31661' => 'X',
  '30773' => 'X',
  '32258' => 'X',
  '30898' => 'X',
  '30676' => 'X',
  '27205' => 'X',
  '31478' => 'X',
  '32748' => 'X',
  '26925' => 'X',
  '31131' => 'E',
  '32733' => 'X',
  '31255' => 'X',
  '31518' => 'X',
  '30766' => 'X',
  '32557' => 'E',
  '32519' => 'X',
  '31312' => 'E',
  '31287' => 'E',
  '31246' => 'E',
  '26867' => 'X',
  '30951' => 'X',
  '31353' => 'E',
  '30863' => 'X',
  '26819' => 'X',
  '30902' => 'E',
  '32307' => 'X',
  '32084' => 'X',
  '31215' => 'X',
  '32103' => 'X',
  '31006' => 'E',
  '30583' => 'E',
  '27172' => 'E',
  '31244' => 'E',
  '31054' => 'X',
  '30748' => 'X',
  '32121' => 'X',
  '30996' => 'X',
  '32425' => 'X',
  '32473' => 'X',
  '30741' => 'X',
  '32560' => 'X',
  '31266' => 'X',
  '30909' => 'E',
  '30640' => 'E',
  '30396' => 'E',
  '32389' => 'X',
  '26763' => 'X',
  '32632' => 'X',
  '30639' => 'X',
  '31853' => 'X',
  '32555' => 'X',
  '26754' => 'E',
  '31317' => 'X',
  '32051' => 'X',
  '32494' => 'X',
  '27206' => 'X',
  '32518' => 'X',
  '30813' => 'X',
  '31672' => 'X',
  '32181' => 'X',
  '32669' => 'X',
  '31318' => 'X',
  '31997' => 'X',
  '31508' => 'X',
  '31326' => 'X',
  '30667' => 'E',
  '31294' => 'E',
  '31087' => 'X',
  '31544' => 'X',
  '31443' => 'X',
  '30887' => 'E',
  '30886' => 'X',
  '31146' => 'X',
  '31363' => 'X',
  '31587' => 'X',
  '30615' => 'E',
  '31763' => 'X',
  '26766' => 'E',
  '31852' => 'E',
  '32453' => 'X',
  '27014' => 'X',
  '32541' => 'X',
  '27203' => 'X',
  '32179' => 'E',
  '32384' => 'X',
  '32423' => 'X',
  '27022' => 'X',
  '30892' => 'E',
  '30714' => 'X',
  '30588' => 'E',
  '32606' => 'X',
  '31451' => 'E',
  '31663' => 'E',
  '30624' => 'X',
  '31873' => 'X',
  '27531' => 'X',
  '32173' => 'X',
  '31513' => 'X',
  '31525' => 'X',
  '30790' => 'X',
  '31934' => 'E',
  '27295' => 'X',
  '26889' => 'E',
  '31236' => 'X',
  '31931' => 'X',
  '31465' => 'X',
  '30869' => 'X',
  '31688' => 'X',
  '31089' => 'X',
  '30823' => 'X',
  '31364' => 'X',
  '32554' => 'X',
  '31245' => 'X',
  '31444' => 'X',
  '31114' => 'X',
  '30921' => 'X',
  '31792' => 'X',
  '30938' => 'E',
  '26901' => 'X',
  '27011' => 'E',
  '31822' => 'X',
  '31076' => 'E',
  '32074' => 'X',
  '32756' => 'X',
  '31348' => 'X',
  '32311' => 'E',
  '30644' => 'X',
  '31820' => 'X',
  '32209' => 'E',
  '31424' => 'E',
  '30756' => 'E',
  '32330' => 'X',
  '32490' => 'X',
  '32716' => 'E',
  '27113' => 'X',
  '26755' => 'E',
  '32596' => 'X',
  '31316' => 'X',
  '30641' => 'X',
  '31135' => 'X',
  '27127' => 'X',
  '32420' => 'X',
  '31374' => 'X',
  '32354' => 'X',
  '30995' => 'X',
  '30642' => 'X',
  '32795' => 'E',
  '31059' => 'X',
  '30970' => 'X',
  '32671' => 'X',
  '32454' => 'X',
  '30750' => 'X',
  '32721' => 'X',
  '31633' => 'X',
  '31660' => 'X',
  '32070' => 'X',
  '32071' => 'X',
  '30896' => 'X',
  '31306' => 'X',
  '31176' => 'E',
  '26995' => 'X',
  '31872' => 'X',
  '30920' => 'E',
  '32422' => 'X',
  '31251' => 'X',
  '31332' => 'X',
  '30976' => 'E',
  '31622' => 'X',
  '31635' => 'X',
  '31503' => 'X',
  '32459' => 'X',
  '32680' => 'X',
  '32622' => 'X',
  '32024' => 'X',
  '31759' => 'X',
  '31319' => 'X',
  '31735' => 'X',
  '32082' => 'X',
  '31454' => 'E',
  '31779' => 'E',
  '31625' => 'E',
  '31850' => 'X',
  '32255' => 'X',
  '31152' => 'X',
  '31611' => 'X',
  '27082' => 'X',
  '31840' => 'X',
  '31283' => 'X',
  '32676' => 'E',
  '32720' => 'X',
  '31790' => 'X',
  '31099' => 'X',
  '31682' => 'X',
  '31062' => 'X',
  '30687' => 'X',
  '27059' => 'X',
  '31442' => 'X',
  '31567' => 'X',
  '32263' => 'X',
  '31636' => 'X',
  '31216' => 'E',
  '32418' => 'X',
  '31849' => 'X',
  '32052' => 'E',
  '32653' => 'X',
  '31163' => 'X',
  '31637' => 'X',
  '30899' => 'X',
  '30914' => 'X',
  '31767' => 'X',
  '31537' => 'X',
  '31491' => 'X',
  '31235' => 'X',
  '31013' => 'X',
  '30443' => 'X',
  '26824' => 'X',
  '31717' => 'X',
  '32650' => 'X',
  '31209' => 'X',
  '27297' => 'X',
  '30958' => 'E',
  '31022' => 'X',
  '32750' => 'X',
  '29188' => 'X',
  '26968' => 'X',
  '26783' => 'X',
  '30957' => 'X',
  '31628' => 'X',
  '30975' => 'X',
  '31021' => 'X',
  '31188' => 'X',
  '26927' => 'E',
  '31744' => 'X',
  '30794' => 'X',
  '31157' => 'E',
  '31971' => 'X',
  '32151' => 'E',
  '30972' => 'E',
  '31174' => 'X',
  '31149' => 'X',
  '32449' => 'X',
  '31339' => 'X',
  '32133' => 'X',
  '32764' => 'X',
  '30803' => 'X',
  '31973' => 'X',
  '31177' => 'X',
  '31100' => 'X',
  '32339' => 'X',
  '32657' => 'X',
  '26916' => 'E',
  '32150' => 'X',
  '32192' => 'X',
  '31485' => 'X',
  '32775' => 'X',
  '31204' => 'X',
  '26779' => 'X',
  '30626' => 'E',
  '26771' => 'X',
  '31845' => 'E',
  '26811' => 'X',
  '31270' => 'E',
  '31060' => 'X',
  '31464' => 'X',
  '31471' => 'X',
  '31649' => 'X',
  '31800' => 'X',
  '31436' => 'X',
  '31260' => 'X',
  '30668' => 'X',
  '26820' => 'X',
  '30814' => 'X',
  '31108' => 'X',
  '31793' => 'X',
  '30666' => 'X',
  '30758' => 'X',
  '31223' => 'X',
  '32783' => 'X',
  '32773' => 'X',
  '30365' => 'E',
  '31279' => 'X',
  '31910' => 'X',
  '32786' => 'X',
  '31378' => 'X',
  '31869' => 'X',
  '31178' => 'X',
  '31696' => 'X',
  '31901' => 'X',
  '31397' => 'X',
  '32408' => 'X',
  '31361' => 'X',
  '31501' => 'X',
  '31907' => 'X',
  '31002' => 'X',
  '30400' => 'X',
  '31347' => 'X',
  '31191' => 'E',
  '31716' => 'X',
  '32191' => 'X',
  '31379' => 'X',
  '26812' => 'E',
  '31011' => 'X',
  '30890' => 'E',
  '31712' => 'X',
  '32132' => 'X',
  '30632' => 'X',
  '32482' => 'E',
  '31261' => 'X',
  '30428' => 'X',
  '32041' => 'E',
  '30584' => 'X',
  '30369' => 'X',
  '30422' => 'X',
  '32118' => 'X',
  '30441' => 'X',
  '30858' => 'X',
  '31014' => 'X',
  '31429' => 'X',
  '30923' => 'X',
  '32611' => 'X',
  '31081' => 'X',
  '32580' => 'X',
  '31201' => 'X',
  '31231' => 'X',
  '26793' => 'X',
  '30931' => 'X',
  '32116' => 'X',
  '32053' => 'X',
  '32153' => 'X',
  '32414' => 'E',
  '32374' => 'X',
  '31983' => 'X',
  '31998' => 'X',
  '32174' => 'X',
  '31512' => 'X',
  '31043' => 'X',
  '32570' => 'X',
  '31380' => 'X',
  '31456' => 'X',
  '32232' => 'E',
  '31276' => 'X',
  '27085' => 'X',
  '30582' => 'X',
  '31019' => 'X',
  '31381' => 'X',
  '30940' => 'X',
  '30822' => 'X',
  '30749' => 'X',
  '31732' => 'X',
  '32604' => 'X',
  '27210' => 'X',
  '30807' => 'X',
  '31887' => 'X',
  '30906' => 'X',
  '31055' => 'E',
  '31579' => 'X',
  '26960' => 'X',
  '29190' => 'X',
  '30847' => 'X',
  '31349' => 'X',
  '31482' => 'X',
  '26876' => 'X',
  '31078' => 'X',
  '27234' => 'E',
  '31166' => 'E',
  '31335' => 'X',
  '32550' => 'X',
  '31976' => 'X',
  '30987' => 'X',
  '31797' => 'E',
  '32197' => 'X',
  '31821' => 'X',
  '30865' => 'X',
  '32523' => 'X',
  '30838' => 'X',
  '31082' => 'X',
  '30789' => 'X',
  '31685' => 'X',
  '27509' => 'X',
  '32079' => 'X',
  '31629' => 'X',
  '31692' => 'X',
  '32530' => 'X',
  '31382' => 'X',
  '31909' => 'X',
  '31383' => 'X',
  '31802' => 'X',
  '31510' => 'X',
  '27184' => 'X',
  '30816' => 'X',
  '32524' => 'X',
  '31448' => 'X',
  '32295' => 'X',
  '32594' => 'X',
  '31384' => 'X',
  '31045' => 'X',
  '31385' => 'X',
  '26758' => 'E',
  '26983' => 'X',
  '31892' => 'X',
  '32407' => 'X',
  '30717' => 'X',
  '30974' => 'X',
  '31016' => 'X',
  '31105' => 'X',
  '31916' => 'X',
  '31221' => 'X',
  '30968' => 'X',
  '31307' => 'X',
  '27037' => 'X',
  '31435' => 'X',
  '32793' => 'X',
  '32222' => 'X',
  '32296' => 'X',
  '31757' => 'X',
  '31651' => 'X',
  '31023' => 'X',
  '31437' => 'X',
  '31762' => 'X',
  '31906' => 'X',
  '32515' => 'X',
  '30977' => 'X',
  '30651' => 'X',
  '30716' => 'X',
  '31497' => 'X',
  '30734' => 'X',
  '31783' => 'E',
  '31679' => 'E',
  '30439' => 'X',
  '30772' => 'X',
  '30715' => 'X',
  '31761' => 'X',
  '31164' => 'X',
  '32034' => 'X',
  '31387' => 'X',
  '26830' => 'E',
  '32784' => 'X',
  '32275' => 'X',
  '31897' => 'X',
  '32402' => 'X',
  '31533' => 'X',
  '30846' => 'X',
  '32663' => 'X',
  '27420' => 'E',
  '31951' => 'X',
  '30930' => 'X',
  '31333' => 'X',
  '32585' => 'E',
  '32337' => 'X',
  '30808' => 'X',
  '31258' => 'X',
  '27009' => 'X',
  '32283' => 'X',
  '32198' => 'X',
  '32025' => 'X',
  '31038' => 'X',
  '30973' => 'X',
  '32189' => 'X',
  '31780' => 'X',
  '32599' => 'X',
  '26813' => 'E',
  '32076' => 'X',
  '32732' => 'X',
  '31388' => 'X',
  '32351' => 'X',
  '32344' => 'X',
  '32610' => 'X',
  '32188' => 'X',
  '32064' => 'X',
  '32221' => 'X',
  '31150' => 'E',
  '31301' => 'X',
  '32106' => 'E',
  '30407' => 'X',
  '30960' => 'X',
  '31389' => 'X',
  '30932' => 'X',
  '30946' => 'X',
  '31919' => 'X',
  '31439' => 'X',
  '31320' => 'X',
  '30947' => 'X',
  '32763' => 'X',
  '31798' => 'X',
  '30835' => 'X',
  '31247' => 'X',
  '31327' => 'X',
  '30800' => 'X',
  '30912' => 'X',
  '31359' => 'X',
  '30986' => 'X',
  '30795' => 'X',
  '31313' => 'X',
  '31226' => 'E',
  '32412' => 'X',
  '31175' => 'X',
  '31854' => 'X',
  '31490' => 'X',
  '32006' => 'X',
  '31040' => 'E',
  '30753' => 'E',
  '30929' => 'X',
  '32434' => 'X',
  '31602' => 'X',
  '31046' => 'X',
  '32383' => 'X',
  '32659' => 'X',
  '26919' => 'E',
  '26816' => 'E',
  '31837' => 'E',
  '31614' => 'X',
  '31615' => 'X',
  '31930' => 'X',
  '32722' => 'X',
  '31550' => 'X',
  '31079' => 'X',
  '30442' => 'E',
  '31917' => 'X',
  '26842' => 'X',
  '31697' => 'X',
  '32639' => 'X',
  '31355' => 'X',
  '27053' => 'E',
  '31552' => 'X',
  '31999' => 'X',
  '30964' => 'X',
  '32131' => 'X',
  '31613' => 'X',
  '32629' => 'X',
  '30405' => 'E',
  '31671' => 'X',
  '31193' => 'E',
  '31799' => 'X',
  '29234' => 'X',
  '26818' => 'E',
  '30754' => 'X',
  '31128' => 'X',
  '32002' => 'X',
  '31390' => 'X',
  '30426' => 'E',
  '30840' => 'X',
  '31004' => 'X',
  '31219' => 'X',
  '30776' => 'E',
  '31648' => 'X',
  '32466' => 'X',
  '32115' => 'X',
  '32487' => 'X',
  '31650' => 'X',
  '31391' => 'X',
  '31080' => 'X',
  '31392' => 'X',
  '31012' => 'X',
  '32661' => 'X',
  '31493' => 'X',
  '31751' => 'X',
  '26860' => 'X',
  '31147' => 'X',
  '31880' => 'X',
  '32590' => 'E',
  '30989' => 'X',
  '26804' => 'X',
  '31213' => 'X',
  '32634' => 'X',
  '32516' => 'X',
  '32246' => 'X',
  '31396' => 'X',
  '27315' => 'X',
  '32364' => 'X',
  '26890' => 'X',
  '32601' => 'E',
  '31324' => 'X',
  '31586' => 'X',
  '31250' => 'E',
  '32172' => 'X',
  '32602' => 'E',
  '30935' => 'E',
  '31638' => 'X',
  '31531' => 'X',
  '31509' => 'X',
  '32390' => 'X',
  '32635' => 'E',
  '26974' => 'X',
  '31253' => 'E',
  '31069' => 'X',
  '32651' => 'X',
  '31061' => 'X',
  '31183' => 'X',
  '31742' => 'X',
  '26997' => 'X',
  '26787' => 'E',
  '31726' => 'E',
  '26772' => 'E',
  '31063' => 'E',
  '31639' => 'X',
  '32031' => 'X',
  '32113' => 'X',
  '32321' => 'X',
  '32510' => 'X',
  '31719' => 'X',
  '31053' => 'E',
  '26822' => 'X',
  '30581' => 'X',
  '32240' => 'X',
  '31393' => 'X',
  '30292' => 'X',
  '31664' => 'E',
  '31572' => 'X',
  '30867' => 'E',
  '30904' => 'E',
  '32403' => 'X',
  '32699' => 'X',
  '27115' => 'X',
  '32388' => 'X',
  '30390' => 'X',
  '32063' => 'X',
  '30650' => 'X',
  '30604' => 'X',
  '31589' => 'X',
  '31206' => 'X',
  '32797' => 'X',
  '30810' => 'X',
  '32171' => 'X',
  '32378' => 'X',
  '31394' => 'X',
  '30990' => 'X',
  '32210' => 'X',
  '30799' => 'X',
  '32562' => 'X',
  '32095' => 'X',
  '32400' => 'X',
  '31707' => 'X',
  '26873' => 'X',
  '32282' => 'X',
  '31282' => 'E',
  '26759' => 'E',
  '31460' => 'X',
  '30834' => 'X',
  '32108' => 'X',
  '32363' => 'E',
  '32238' => 'X',
  '31297' => 'E',
  '32575' => 'X',
  '31151' => 'X',
  '32328' => 'X',
  '32329' => 'X',
  '30804' => 'X',
  '32587' => 'X',
  '27439' => 'X',
  '30784' => 'X',
  '30913' => 'X',
  '31066' => 'X',
  '30956' => 'X',
  '31187' => 'X',
  '31827' => 'X',
  '32280' => 'X',
  '30421' => 'X',
  '31248' => 'X',
  '26921' => 'X',
  '26946' => 'X',
  '32719' => 'E',
  '31263' => 'X',
  '31585' => 'X',
  '31745' => 'X',
  '31252' => 'X',
  '32058' => 'X',
  '32015' => 'X',
  '31640' => 'X',
  '30649' => 'E',
  '27042' => 'E',
  '32734' => 'X',
  '32164' => 'E',
  '27498' => 'X',
  '27495' => 'X',
  '32044' => 'X',
  '30936' => 'E',
  '31824' => 'X',
  '31000' => 'X',
  '30819' => 'E',
  '31624' => 'X',
  '32469' => 'X',
  '30818' => 'X',
  '32559' => 'X',
  '30597' => 'X',
  '31143' => 'E',
  '30736' => 'X',
  '31601' => 'E',
  '31293' => 'X',
  '32543' => 'X',
  '30939' => 'E',
  '32593' => 'X',
  '31723' => 'X',
  '32698' => 'X',
  '31399' => 'X',
  '31350' => 'X',
  '30646' => 'X',
  '30623' => 'X',
  '30843' => 'X',
  '26808' => 'X',
  '31942' => 'E',
  '31760' => 'X',
  '31329' => 'X',
  '32794' => 'X',
  '32294' => 'X',
  '31588' => 'X',
  '31502' => 'X',
  '30391' => 'E',
  '31570' => 'E',
  '30982' => 'E',
  '31239' => 'E',
  '31064' => 'X',
  '31817' => 'X',
  '32350' => 'X',
  '31791' => 'X',
  '30894' => 'E',
  '31005' => 'X',
  '30950' => 'X',
  '31018' => 'X',
  '32012' => 'X',
  '32782' => 'X',
  '27363' => 'X',
  '31557' => 'X',
  '31278' => 'X',
  '30860' => 'E',
  '31933' => 'X',
  '32597' => 'E',
  '31212' => 'X',
  '32505' => 'X',
  '30824' => 'X',
  '31400' => 'X',
  '31237' => 'X',
  '32231' => 'X',
  '31401' => 'X',
  '32314' => 'X',
  '31402' => 'X',
  '32141' => 'X',
  '32336' => 'X',
  '32747' => 'X',
  '30695' => 'X',
  '31419' => 'X',
  '32196' => 'X',
  '32259' => 'X',
  '31558' => 'X',
  '32152' => 'X',
  '31598' => 'X',
  '32774' => 'X',
  '30859' => 'X',
  '30934' => 'X',
  '30805' => 'X',
  '31766' => 'X',
  '30765' => 'X',
  '32633' => 'E',
  '30870' => 'X',
  '32401' => 'X',
  '27502' => 'E',
  '32030' => 'X',
  '31352' => 'X',
  '32613' => 'X',
  '31133' => 'X',
  '31569' => 'X',
  '30774' => 'X',
  '31573' => 'X',
  '31200' => 'X',
  '31110' => 'E',
  '30368' => 'X',
  '31041' => 'X',
  '31530' => 'X',
  '31662' => 'X',
  '32603' => 'X',
  '31229' => 'X',
  '32202' => 'X',
  '31202' => 'X',
  '31455' => 'X',
  '32614' => 'E',
  '32498' => 'X',
  '32124' => 'X',
  '32517' => 'X',
  '32531' => 'X',
  '31549' => 'X',
  '26923' => 'E',
  '32588' => 'X',
  '32170' => 'E',
  '31924' => 'X',
  '26791' => 'E',
  '27421' => 'X',
  '26951' => 'X',
  '27001' => 'X',
  '30316' => 'X',
  '27041' => 'X',
  '27124' => 'E',
  '31358' => 'X',
  '32493' => 'E',
  '30907' => 'X',
  '30991' => 'E',
  '32341' => 'E',
  '29200' => 'X',
  '31980' => 'X',
  '30922' => 'E',
  '32257' => 'X',
  '31264' => 'E',
  '31330' => 'X',
  '26832' => 'X',
  '31088' => 'X',
  '30731' => 'X',
  '27301' => 'E',
  '30745' => 'X',
  '30872' => 'E',
  '31189' => 'X',
  '32043' => 'X',
  '32533' => 'X',
  '31756' => 'X',
  '32644' => 'X',
  '31666' => 'X',
  '31173' => 'X',
  '31694' => 'E',
  '32320' => 'E',
  '30885' => 'X',
  '31440' => 'X',
  '32195' => 'X',
  '31706' => 'X',
  '32751' => 'X',
  '31641' => 'X',
  '32723' => 'X',
  '31366' => 'X',
  '31753' => 'X',
  '31905' => 'X',
  '30675' => 'E',
  '31406' => 'X',
  '32016' => 'X',
  '30985' => 'E',
  '31674' => 'X',
  '26780' => 'X',
  '26828' => 'X',
  '32207' => 'X',
  '32621' => 'X',
  '32218' => 'E',
  '31818' => 'X',
  '31407' => 'X',
  '31839' => 'X',
  '30815' => 'X',
  '31286' => 'X',
  '31896' => 'E',
  '31486' => 'X',
  '32534' => 'X',
  '31835' => 'E',
  '31642' => 'X',
  '31667' => 'X',
  '32003' => 'X',
  '32154' => 'X',
  '30882' => 'X',
  '31505' => 'X',
  '31524' => 'X',
  '30412' => 'X',
  '26914' => 'X',
  '26776' => 'X',
  '27101' => 'X',
  '26954' => 'X',
  '31044' => 'X',
  '30420' => 'X',
  '30905' => 'X',
  '32470' => 'X',
  '31345' => 'X',
  '26838' => 'E',
  '32532' => 'X',
  '30625' => 'E',
  '31234' => 'X',
  '32679' => 'X',
  '30901' => 'X',
  '27006' => 'X',
  '31922' => 'X',
  '32512' => 'X',
  '32254' => 'X',
  '31365' => 'X',
  '30980' => 'X',
  '31972' => 'X',
  '32762' => 'E',
  '31240' => 'X',
  '30948' => 'X',
  '31810' => 'X',
  '31857' => 'X',
  '30410' => 'X',
  '31441' => 'X',
  '31580' => 'X',
  '31472' => 'X',
  '31516' => 'X',
  '31117' => 'X',
  '32451' => 'X',
  '26767' => 'X',
  '31010' => 'E',
  '31408' => 'X',
  '30622' => 'E',
  '32293' => 'X',
  '31015' => 'E',
  '31775' => 'X',
  '32468' => 'X',
  '31940' => 'X',
  '31874' => 'X',
  '32089' => 'X',
  '31199' => 'X',
  '31856' => 'E',
  '30760' => 'X',
  '26760' => 'X',
  '26799' => 'X',
  '31506' => 'E',
  '30778' => 'X',
  '32168' => 'X',
  '32660' => 'X',
  '32664' => 'X',
  '31409' => 'X',
  '31770' => 'X',
  '31190' => 'E',
  '31816' => 'E',
  '30757' => 'X',
  '31643' => 'X',
  '31410' => 'X',
  '30370' => 'X',
  '31710' => 'X',
  '32035' => 'X',
  '32474' => 'X',
  '31474' => 'E',
  '30762' => 'X',
  '30893' => 'X',
  '31705' => 'E',
  '30740' => 'E',
  '31750' => 'E',
  '26992' => 'E',
  '32080' => 'X',
  '26900' => 'X',
  '30780' => 'X',
  '27185' => 'E',
  '26825' => 'E',
  '32256' => 'X',
  '32122' => 'X',
  '32471' => 'E',
  '31581' => 'X',
  '31554' => 'X',
  '32600' => 'E',
  '32187' => 'X',
  '31074' => 'X',
  '31299' => 'X',
  '30711' => 'X',
  '30440' => 'X',
  '31438' => 'X',
  '32331' => 'X',
  '31899' => 'X',
  '32548' => 'X',
  '31068' => 'X',
  '26920' => 'E',
  '30966' => 'X',
  '30802' => 'X',
  '26814' => 'X',
  '32069' => 'X',
  '31411' => 'X',
  '31047' => 'E',
  '32598' => 'X',
  '31207' => 'E',
  '26796' => 'X',
  '26801' => 'X',
  '31238' => 'X',
  '32072' => 'X',
  '27423' => 'E',
  '30409' => 'X',
  '31949' => 'X',
  '27366' => 'E',
  '31322' => 'X',
  '32592' => 'X',
  '30796' => 'E',
  '30988' => 'X',
  '30979' => 'X',
  '26810' => 'X',
  '26944' => 'X',
  '31356' => 'X',
  '26896' => 'X',
  '31254' => 'X',
  '31145' => 'X',
  '31494' => 'X',
  '31918' => 'X',
  '31819' => 'X',
  '30943' => 'X',
  '32088' => 'X',
  '31172' => 'X',
  '32338' => 'X',
  '32525' => 'X',
  '27038' => 'X',
  '30388' => 'X',
  '30444' => 'X',
  '32480' => 'X',
  '26795' => 'E',
  '32564' => 'X',
  '30967' => 'X',
  '31796' => 'X',
  '32065' => 'X',
  '32026' => 'X',
  '32081' => 'E',
  '32612' => 'X',
  '30621' => 'X',
  '31412' => 'X',
  '32371' => 'X',
  '29189' => 'X',
  '31214' => 'E',
  '30786' => 'X',
  '32048' => 'X',
  '31084' => 'X',
  '26777' => 'E',
  '31344' => 'X',
  '27065' => 'E',
  '32091' => 'X',
  '27047' => 'X',
  '27090' => 'E',
  '30897' => 'E',
  '31956' => 'X',
  '32740' => 'X',
  '31848' => 'X',
  '31566' => 'X',
  '26879' => 'E',
  '30366' => 'E',
  '30969' => 'X',
  '31583' => 'X',
  '30884' => 'X',
  '31020' => 'E',
  '32684' => 'X',
  '32788' => 'X',
  '31090' => 'E',
  '30698' => 'E',
  '32332' => 'X',
  '31477' => 'X',
  '32526' => 'X',
  '32397' => 'X',
  '31210' => 'X',
  '30665' => 'X',
  '32216' => 'E',
  '31957' => 'X',
  '31445' => 'X',
  '30792' => 'X',
  '32007' => 'E',
  '31483' => 'X',
  '32623' => 'X',
  '32308' => 'X',
  '31559' => 'X',
  '31321' => 'X',
  '31165' => 'X',
  '31495' => 'X',
  '30911' => 'X',
  '27424' => 'X',
  '31823' => 'X',
  '31141' => 'X',
  '30944' => 'X',
  '31794' => 'X',
  '31644' => 'X',
  '31675' => 'X',
  '31807' => 'X',
  '31009' => 'X',
  '31941' => 'X',
  '32008' => 'X',
  '32233' => 'X',
  '30961' => 'X',
  '31262' => 'X',
  '31473' => 'X',
  '30962' => 'E',
  '31594' => 'E',
  '31431' => 'X',
  '31142' => 'X',
  '31104' => 'E',
  '30875' => 'X',
  '31702' => 'X',
  '31413' => 'X',
  '31077' => 'X',
  '31433' => 'X',
  '31300' => 'X',
  '30787' => 'X',
  '31341' => 'X',
  '31309' => 'E',
  '32352' => 'X',
  '31603' => 'X',
  '32511' => 'X',
  '26962' => 'X',
  '27209' => 'X',
  '30718' => 'X',
  '26823' => 'X',
  '31815' => 'X',
  '31458' => 'E',
  '31203' => 'X',
  '26847' => 'X',
  '26809' => 'E',
  '26800' => 'E',
  '32289' => 'X',
  '26761' => 'X',
  '26928' => 'E',
  '32799' => 'X',
  '32011' => 'X',
  '30954' => 'E',
  '32708' => 'X',
  '31541' => 'X',
  '31605' => 'X',
  '32709' => 'E',
  '31211' => 'E',
  '30759' => 'X',
  '30866' => 'X',
  '30817' => 'X',
  '30978' => 'X',
  '30994' => 'X',
  '26774' => 'X',
  '27106' => 'X',
  '32628' => 'X',
  '32578' => 'E',
  '32462' => 'X',
  '31228' => 'X',
  '31476' => 'X',
  '30955' => 'X',
  '31548' => 'X',
  '31571' => 'X',
  '30389' => 'X',
  '30324' => 'E',
  '26957' => 'X',
  '31360' => 'X',
  '32791' => 'X',
  '30752' => 'X',
  '31230' => 'X',
  '32556' => 'X',
  '31328' => 'X',
  '27499' => 'E',
  '32485' => 'X',
  '32056' => 'E',
  '32476' => 'X',
  '31153' => 'X',
  '32419' => 'X',
  '32665' => 'X',
  '31154' => 'X',
  '32636' => 'X',
  '31414' => 'X',
  '30916' => 'E',
  '31354' => 'X',
  '26789' => 'X',
  '31568' => 'X',
  '31737' => 'X',
  '32223' => 'X',
  '31623' => 'X',
  '30861' => 'X',
  '30949' => 'X',
  '32507' => 'X',
  '31982' => 'X',
  '31789' => 'X',
  '32579' => 'X',
  '26999' => 'X',
  '31864' => 'X',
  '31693' => 'X',
  '31731' => 'X',
  '32486' => 'X',
  '32217' => 'X',
  '31136' => 'E',
  '32244' => 'E',
  '32436' => 'E',
  '31259' => 'X',
  '27064' => 'X',
  '30777' => 'X',
  '31838' => 'X',
  '31670' => 'X',
  '30782' => 'X',
  '31428' => 'E',
  '31730' => 'E',
  '31627' => 'X',
  '31308' => 'X',
  '32348' => 'X',
  '31222' => 'X',
  '32755' => 'E',
  '31540' => 'X',
  '31736' => 'X',
  '30874' => 'X',
  '32299' => 'X',
  '26782' => 'E',
  '31073' => 'X',
  '31700' => 'X',
  '32000' => 'X',
  '31351' => 'E',
  '31826' => 'X',
  '31220' => 'X',
  '32097' => 'X',
  '32184' => 'X',
  '30558' => 'X',
  '30821' => 'X',
  '31346' => 'X',
  '30854' => 'X',
  '32136' => 'X',
  '30603' => 'E',
  '31285' => 'X',
  '32298' => 'X',
  '31197' => 'X',
  '31148' => 'X',
  '32109' => 'X',
  '32395' => 'X',
  '31870' => 'X',
  '31522' => 'X',
  '31065' => 'X',
  '32147' => 'E',
  '31083' => 'X',
  '31048' => 'X',
  '30926' => 'X',
  '30589' => 'X',
  '30627' => 'X',
  '26773' => 'X',
  '31421' => 'X',
  '31280' => 'X',
  '31865' => 'X',
  '30826' => 'X',
  '31986' => 'X',
  '31375' => 'X',
  '30696' => 'X',
  '31701' => 'E',
  '32183' => 'E',
  '31277' => 'X',
  '30574' => 'X',
  '31420' => 'X',
  '31668' => 'X',
  '27051' => 'E',
  '27240' => 'X',
  '30876' => 'X',
  '31834' => 'X',
  '30781' => 'X',
  '26858' => 'E',
  '32268' => 'X',
  '31134' => 'E',
  '31039' => 'X',
  '32094' => 'X',
  '31781' => 'X',
  '27132' => 'X',
  '31496' => 'E',
  '26949' => 'X',
  '30963' => 'E',
  '31182' => 'X',
  '31806' => 'X',
  '32148' => 'X',
  '31418' => 'X',
  '31416' => 'X',
  '32125' => 'X',
  '31417' => 'X',
  '30785' => 'X',
  '26883' => 'X',
  '32710' => 'E',
  '30925' => 'E',
  '31205' => 'E',
  '30959' => 'X',
  '31484' => 'X',
  '31923' => 'X',
  '26899' => 'X',
  '32127' => 'E',
  '31480' => 'X',
  '30344' => 'E',
  '30746' => 'E',
  '31056' => 'X',
  '31645' => 'X',
  '32379' => 'E',
  '31646' => 'X',
  '31738' => 'X',
  '30809' => 'X',
  '26902' => 'X',
  '31179' => 'X',
  '27046' => 'X',
  '32467' => 'X',
  '32114' => 'X',
  '31334' => 'X',
  '26805' => 'X',
  '30877' => 'X',
  '31106' => 'X',
  '31647' => 'X',
  '31758' => 'X',
  '31144' => 'X',
  '32288' => 'X',
  '31075' => 'X',
  '30659' => 'X',
  '31194' => 'X',
  '31656' => 'X',
  '27371' => 'X',
  '30852' => 'E',
);

//var_dump($ryhmakonversio);
//exit;

$query = "SELECT *
          FROM toimi
          WHERE yhtio  = 'atarv'
          AND tyyppi  != 'K'";
$query_result = mysql_query($query) or pupe_error($query);

while ($query_row = mysql_fetch_assoc($query_result)) {

  // jos X & P, niin siirretään yhtiöltä toiselle + tsekataa tarkenteet
  // jos R niin tsekataa onko relaatioita (tiliöintisäännöt vois olla hyvä täs kohtaa)
  // jos R keissi, niin relaatioille pitää laittaa Örskan tunnukset
  // jos E, älä tee mitää

  // Ei ohiteta E-keissejä, vaan tuodaan niissäkin relaatiot kuten R
  //  if ($toimikonversio[$query_row['tunnus']] == 'E') continue;

  // jos indexsiä ei ole setattu, continue

  if (!isset($toimikonversio[$query_row['tunnus']])) {
    continue;
  }

  if ($toimikonversio[$query_row['tunnus']] == 'X' or $toimikonversio[$query_row['tunnus']] == 'P') {

    // rubicon_konversio.sql hoitaa tiliöintisäännöt yms artr:lle, joten niit ei tarvii täs säätää.
    $query = "UPDATE toimi
              JOIN kustannuspaikka m1 on (m1.yhtio = toimi.yhtio and m1.tunnus = toimi.kustannuspaikka)
              LEFT JOIN kustannuspaikka m2 on (m2.yhtio = 'artr' and m1.koodi = m2.koodi)
              SET toimi.kustannuspaikka = if(m2.tunnus is null, 0, m2.tunnus)
              WHERE toimi.yhtio = 'atarv' AND toimi.tunnus = '{$query_row['tunnus']}'";
    pupe_query($query);
    $query = "UPDATE toimi
              JOIN kustannuspaikka m1 on (m1.yhtio = toimi.yhtio and m1.tunnus = toimi.projekti)
              LEFT JOIN kustannuspaikka m2 on (m2.yhtio = 'artr' and m1.koodi = m2.koodi)
              SET toimi.projekti = if(m2.tunnus is null, 0, m2.tunnus)
              WHERE toimi.yhtio = 'atarv' AND toimi.tunnus = '{$query_row['tunnus']}'";
    pupe_query($query);
    $query = "UPDATE toimi
              JOIN kustannuspaikka m1 on (m1.yhtio = toimi.yhtio and m1.tunnus = toimi.kohde)
              LEFT JOIN kustannuspaikka m2 on (m2.yhtio = 'artr' and m1.koodi = m2.koodi)
              SET toimi.kohde = if(m2.tunnus is null, 0, m2.tunnus)
              WHERE toimi.yhtio = 'atarv' AND toimi.tunnus = '{$query_row['tunnus']}'";
    pupe_query($query);

    $poistotilaan = '';
    if ($toimikonversio[$query_row['tunnus']] == 'P') $poistotilaan = ", toimi.tyyppi = 'P'";

    $query = "UPDATE toimi
              SET toimi.yhtio = 'artr' $poistotilaan
              WHERE toimi.yhtio = 'atarv' AND toimi.tunnus = '{$query_row['tunnus']}'";
    pupe_query($query);
  }

  if ($toimikonversio[$query_row['tunnus']] == 'E') {

    $query = "SELECT *
              FROM toimi
              WHERE yhtio = 'artr'
              AND tyyppi  not in ('K','P')
              AND ytunnus = '{$query_row['ytunnus']}'";
    $query_result2 = pupe_query($query);

    unset($trow);

    if (mysql_num_rows($query_result2) == 1) {
      $trow = mysql_fetch_assoc($query_result2);
    }

    if (!isset($trow)) {
      // siivotaa vähä ytunnusta
      $ytunnus = preg_replace("/[^0-9]/", "", $query_row['ytunnus']);
      $query = "SELECT *
                FROM toimi
                WHERE yhtio = 'artr'
                AND tyyppi  not in ('K','P')
                AND ytunnus = '$ytunnus'";
      $query_result2 = pupe_query($query);
      if (mysql_num_rows($query_result2) == 1) {
        $trow = mysql_fetch_assoc($query_result2);
      }
    }

    if (!isset($trow)) {
      // voi myös olla et kannan ytunnuksessa on kirjaimia mut $ytunnus muuttujassa ei, joten kokeillaan vielä näin (FI1234 like %1234)
      $query = "SELECT *
                FROM toimi
                WHERE yhtio = 'artr'
                AND tyyppi  not in ('K','P')
                AND ytunnus like '%$ytunnus'";
      $query_result2 = pupe_query($query);
      if (mysql_num_rows($query_result2) == 1) {
        $trow = mysql_fetch_assoc($query_result2);
      }
    }

    if (isset($trow)) {
      // toimittaja löytyi, päivitä relaatiot pointtaamaan löydettyyn toimittajaan. laskut ja tiliointisäännöt siirretään rubicon_konversio.sql:ssä atarv -> artr
      // tiliöintisäännöt
      // lasku tila O, K

      $query = "UPDATE tiliointisaanto
                SET tiliointisaanto.ttunnus = '{$trow['tunnus']}'
                WHERE tiliointisaanto.yhtio = 'atarv' AND tiliointisaanto.ttunnus = '{$query_row['tunnus']}'";
      pupe_query($query);

      $query = "UPDATE lasku
                SET lasku.liitostunnus = '{$trow['tunnus']}'
                WHERE lasku.yhtio      = 'atarv'
                AND lasku.tila         in ('O','K')
                AND lasku.liitostunnus = '{$query_row['tunnus']}'";
      pupe_query($query);
    }
    else {
      echo "\nMasin toimittajaa $query_row[ytunnus] - $query_row[nimi] ei löydy artr:stä ytunnuksella + ytunnuksella ilman kirjaimia (yksi osuma pitää löytää)";
    }
  }
}

echo "\n";
