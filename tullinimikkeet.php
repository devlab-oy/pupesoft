<?php

require "inc/parametrit.inc";

echo "<font class='head'>".t("Tullinimikkeet")."</font><hr>";

/*
// nämä pitää ajaa jos päivittää uudet tullinimikkeet:
update tullinimike set su=trim(su);
update tullinimike set su='' where su='-';
update tullinimike set su_vientiilmo='NAR' where su='p/st';
update tullinimike set su_vientiilmo='MIL' where su='1 000 p/st';
update tullinimike set su_vientiilmo='MIL' where su='1000 p/st';
update tullinimike set su_vientiilmo='LPA' where su='l alc. 100';
update tullinimike set su_vientiilmo='LTR' where su='l';
update tullinimike set su_vientiilmo='KLT' where su='1 000 l';
update tullinimike set su_vientiilmo='KLT' where su='1000 l';
update tullinimike set su_vientiilmo='TJO' where su='TJ';
update tullinimike set su_vientiilmo='MWH' where su='1 000 kWh';
update tullinimike set su_vientiilmo='MWH' where su='1000 kWh';
update tullinimike set su_vientiilmo='MTQ' where su='m³';
update tullinimike set su_vientiilmo='MTQ' where su='m3';
update tullinimike set su_vientiilmo='GRM' where su='g';
update tullinimike set su_vientiilmo='MTK' where su='m²';
update tullinimike set su_vientiilmo='MTK' where su='m2';
update tullinimike set su_vientiilmo='MTR' where su='m';
update tullinimike set su_vientiilmo='NPR' where su='pa';
update tullinimike set su_vientiilmo='CEN' where su='100 p/st';
update tullinimike set su_vientiilmo='KGE' where su='kg/net eda';
update tullinimike set su_vientiilmo='LPA' where su='l alc. 100%';
update tullinimike set su_vientiilmo='KCC' where su='kg C5H14ClNO';
update tullinimike set su_vientiilmo='MTC' where su='1000 m3';
update tullinimike set su_vientiilmo='KPP' where su='kg P2O5';
update tullinimike set su_vientiilmo='KSH' where su='kg NaOH';
update tullinimike set su_vientiilmo='KPH' where su='kg KOH';
update tullinimike set su_vientiilmo='KUR' where su='kg U';
update tullinimike set su_vientiilmo='GFI' where su='gi F/S';
update tullinimike set su_vientiilmo='KNS' where su='kg H2O2';
update tullinimike set su_vientiilmo='KMA' where su='kg met.am.';
update tullinimike set su_vientiilmo='KNI' where su='kg N';
update tullinimike set su_vientiilmo='KPO' where su='kg K2O';
update tullinimike set su_vientiilmo='KSD' where su='kg 90% sdt';
update tullinimike set su_vientiilmo='CTM' where su='c/k';
update tullinimike set su_vientiilmo='NCL' where su='ce/el';
update tullinimike set su_vientiilmo='CCT' where su='ct/l';
*/

if ($tee == "muuta") {

  $ok = 0;
  $uusitullinimike1 = trim($uusitullinimike1);
  $uusitullinimike2 = trim($uusitullinimike2);

  // katotaan, että tullinimike1 löytyy
  $query = "SELECT cn FROM tullinimike WHERE cn = '$uusitullinimike1' and kieli = '$yhtiorow[kieli]'";
  $result = pupe_query($query);

  if (mysql_num_rows($result) != 1 or $uusitullinimike1 == "") {
    $ok = 1;
    echo "<font class='error'>Tullinimike 1 on virheellinen!</font><br>";
  }

  // kaks pitkä tai ei mitään
  if (strlen($uusitullinimike2) != 2) {
    $ok = 1;
    echo "<font class='error'>Tullinimike 2 tulee olla 2 merkkiä pitkä!</font><br>";
  }

  // tää on aika fiinisliippausta
  if ($ok == 1) echo "<br>";

  // jos kaikki meni ok, nii päivitetään
  if ($ok == 0) {

    if ($tullinimike2 != "") $lisa = " and tullinimike2='$tullinimike2'";
    else $lisa = "";

    $query = "update tuote set tullinimike1='$uusitullinimike1', tullinimike2='$uusitullinimike2' where yhtio='$kukarow[yhtio]' and tullinimike1='$tullinimike1' $lisa";
    $result = pupe_query($query);

    echo sprintf("<font class='message'>Päivitettiin %s tuotetta.</font><br><br>", mysql_affected_rows());

    $tullinimike1 = $uusitullinimike1;
    $tullinimike2 = $uusitullinimike2;
    $uusitullinimike1 = "";
    $uusitullinimike2 = "";
  }
}

if ($tee == "synkronoi") {

  $ch  = curl_init();
  curl_setopt($ch, CURLOPT_URL, "http://pupeapi.sprintit.fi/referenssitullinimikkeet.sql");
  curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
  curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, FALSE);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
  curl_setopt($ch, CURLOPT_HEADER, FALSE);
  $nimikeet = curl_exec($ch);

  // Käännetään aliakset UTF-8 muotoon, jos Pupe on UTF-8:ssa
  if (PUPE_UNICODE) {
    // Tässä on "//NO_MB_OVERLOAD"-kommentti
    // jotta UTF8-konversio ei osu tähän riviin
    $nimikeet = utf8_encode($nimikeet); //NO_MB_OVERLOAD
  }

  $nimikeet = explode("\n", trim($nimikeet));

  if (count($nimikeet) == 0) {
    echo t("Tiedoston avaus epäonnistui")."!";
    require "inc/footer.inc";
    exit;
  }

  echo "<br><br>";
  echo t("Poistetaan vanhat tullinimikkeet")."...<br>";

  // Poistetaan nykyiset nimikkeet....
  $query  = "DELETE FROM tullinimike";
  $result = pupe_query($query);

  // Päivitetään tuotteet 2021 - 2022
  $muunnosavaimet = array(
    "02089098" => "02089098",
    "02089098" => "04101010",
    "02109939" => "02109939",
    "02109939" => "04101099",
    "02109990" => "02109990",
    "02109990" => "04101091",
    "03051000" => "03091000",
    "03061990" => "03061990",
    "03061990" => "03099000",
    "03063990" => "03063990",
    "03063990" => "03099000",
    "03069990" => "03069990",
    "03069990" => "03099000",
    "03072100" => "03072110",
    "03072900" => "03072910",
    "03079100" => "03072190",
    "03079100" => "03079100",
    "03079100" => "03099000",
    "03079200" => "03072295",
    "03079200" => "03079200",
    "03079200" => "03099000",
    "03079900" => "03072990",
    "03079900" => "03079900",
    "03079900" => "03099000",
    "03089090" => "03089090",
    "03089090" => "03099000",
    "04031011" => "04032011",
    "04031013" => "04032013",
    "04031019" => "04032019",
    "04031031" => "04032031",
    "04031033" => "04032033",
    "04031039" => "04032039",
    "04031051" => "04032051",
    "04031053" => "04032053",
    "04031059" => "04032059",
    "04031091" => "04032091",
    "04031093" => "04032093",
    "04031099" => "04032099",
    "04100000" => "04109000",
    "07041000" => "07041010",
    "07049090" => "07041090",
    "07049090" => "07049090",
    "07095910" => "07095300",
    "07095930" => "07095200",
    "07095950" => "07095600",
    "07095990" => "07095400",
    "07095990" => "07095500",
    "07095990" => "07095900",
    "07123900" => "07123400",
    "07123900" => "07123900",
    "08029010" => "08029910",
    "08029050" => "08029100",
    "08029050" => "08029200",
    "08029085" => "08029990",
    "12119086" => "12116000",
    "12119086" => "12119086",
    "15091010" => "15094000",
    "15091020" => "15092000",
    "15091080" => "15093000",
    "15100010" => "15101000",
    "15100090" => "15109000",
    "15159040" => "15156011",
    "15159040" => "15159040",
    "15159051" => "15156051",
    "15159051" => "15159051",
    "15159059" => "15156059",
    "15159059" => "15159059",
    "15159060" => "15156060",
    "15159060" => "15159060",
    "15159091" => "15156091",
    "15159091" => "15159091",
    "15159099" => "15156099",
    "15159099" => "15159099",
    "15162091" => "15162091",
    "15162091" => "15163091",
    "15162098" => "15162098",
    "15162098" => "15163098",
    "16010091" => "16010091",
    "16010099" => "16010099",
    "16021000" => "16021000",
    "16029099" => "16029099",
    "17049099" => "16021000",
    "17049099" => "16029099",
    "17049099" => "17049099",
    "18069090" => "16021000",
    "18069090" => "16029099",
    "18069090" => "18069090",
    "19019091" => "04032041",
    "19019091" => "16021000",
    "19019091" => "16029099",
    "19019091" => "19019091",
    "19019099" => "04032049",
    "19019099" => "16021000",
    "19019099" => "16029099",
    "19019099" => "19019099",
    "19049080" => "16021000",
    "19049080" => "16029099",
    "19049080" => "19049080",
    "21069092" => "16010091",
    "21069092" => "16010099",
    "21069092" => "16021000",
    "21069092" => "16029099",
    "21069092" => "21069092",
    "21069092" => "24049110",
    "24039100" => "24039100",
    "24039100" => "24041100",
    "24039990" => "24039990",
    "24039990" => "24041100",
    "24039990" => "24041910",
    "24039990" => "24049190",
    "25183000" => "38160010",
    "28444010" => "28444310",
    "28444020" => "28444110",
    "28444020" => "28444210",
    "28444020" => "28444320",
    "28444030" => "28444110",
    "28444030" => "28444210",
    "28444030" => "28444320",
    "28444080" => "28444190",
    "28444080" => "28444290",
    "28444080" => "28444380",
    "28444080" => "28444400",
    "28459090" => "28452000",
    "28459090" => "28453000",
    "28459090" => "28454000",
    "28459090" => "28459090",
    "29033100" => "29036200",
    "29033911" => "29036100",
    "29033915" => "29036911",
    "29033919" => "29036919",
    "29033921" => "29034200",
    "29033923" => "29034100",
    "29033924" => "29034400",
    "29033925" => "29034300",
    "29033926" => "29034500",
    "29033927" => "29034600",
    "29033927" => "29034700",
    "29033927" => "29034910",
    "29033928" => "29034930",
    "29033929" => "29034300",
    "29033929" => "29034400",
    "29033929" => "29034500",
    "29033929" => "29034800",
    "29033929" => "29034990",
    "29033931" => "29035100",
    "29033935" => "29035100",
    "29033939" => "29035100",
    "29033939" => "29035900",
    "29033980" => "29036980",
    "29096000" => "29096090",
    "29110000" => "29096010",
    "29110000" => "29110000",
    "29309098" => "29301000",
    "29309098" => "29309098",
    "29313100" => "29314100",
    "29313200" => "29314200",
    "29313300" => "29314300",
    "29313400" => "29314910",
    "29313500" => "29314600",
    "29313600" => "29314700",
    "29313700" => "29314920",
    "29313800" => "29314500",
    "29313920" => "29315910",
    "29313930" => "29315100",
    "29313950" => "29314930",
    "29313960" => "29314940",
    "29313990" => "29314400",
    "29313990" => "29314800",
    "29313990" => "29314990",
    "29313990" => "29315200",
    "29313990" => "29315300",
    "29313990" => "29315400",
    "29313990" => "29315990",
    "29329900" => "29329600",
    "29329900" => "29329900",
    "29333300" => "29333300",
    "29333999" => "29333300",
    "29333999" => "29333400",
    "29333999" => "29333500",
    "29333999" => "29333600",
    "29333999" => "29333700",
    "29333999" => "29333999",
    "29349990" => "29349200",
    "29349990" => "29349990",
    "29394900" => "29394900",
    "29397100" => "29394500",
    "29397100" => "29394900",
    "29397100" => "29397200",
    "29397990" => "29394900",
    "29397990" => "29397990",
    "30021100" => "38221100",
    "30021300" => "30021300",
    "30021300" => "38221100",
    "30021300" => "38221200",
    "30021300" => "38221900",
    "30021400" => "30021400",
    "30021400" => "38221100",
    "30021400" => "38221200",
    "30021400" => "38221900",
    "30021500" => "30021500",
    "30021500" => "38221100",
    "30021500" => "38221200",
    "30021500" => "38221900",
    "30021900" => "38221900",
    "30022010" => "30024110",
    "30022090" => "30024190",
    "30023000" => "30024200",
    "30029050" => "30024900",
    "30029090" => "30024900",
    "30029090" => "30025100",
    "30029090" => "30025900",
    "30029090" => "30029090",
    "30049000" => "30049000",
    "30049000" => "30069300",
    "30062000" => "38221300",
    "32041700" => "32041700",
    "32041700" => "32041800",
    "32041900" => "32041800",
    "32041900" => "32041900",
    "33012941" => "33012942",
    "33012941" => "33012949",
    "34021110" => "34023910",
    "34021190" => "34023100",
    "34021190" => "34023990",
    "34021200" => "34024100",
    "34021300" => "34024200",
    "34021900" => "34024900",
    "34022020" => "34025010",
    "34022090" => "34025090",
    "36030020" => "36031000",
    "36030030" => "36032000",
    "36030040" => "36033000",
    "36030050" => "36034000",
    "36030060" => "36035000",
    "36030080" => "36036000",
    "38085900" => "38085900",
    "38089120" => "38085900",
    "38089120" => "38089120",
    "38089130" => "38085900",
    "38089130" => "38089130",
    "38089140" => "38085900",
    "38089140" => "38089140",
    "38089190" => "38085900",
    "38089190" => "38089190",
    "38089290" => "38085900",
    "38089290" => "38089290",
    "38160000" => "38160090",
    "38220000" => "38221200",
    "38220000" => "38221900",
    "38220000" => "38229000",
    "38247100" => "38271100",
    "38247200" => "38272000",
    "38247300" => "38271200",
    "38247400" => "38273100",
    "38247400" => "38273200",
    "38247400" => "38273900",
    "38247500" => "38271300",
    "38247600" => "38271400",
    "38247700" => "38274000",
    "38247810" => "38276100",
    "38247810" => "38276200",
    "38247810" => "38276300",
    "38247820" => "38276100",
    "38247820" => "38276200",
    "38247820" => "38276300",
    "38247820" => "38276400",
    "38247830" => "38276200",
    "38247830" => "38276300",
    "38247830" => "38276500",
    "38247840" => "38276200",
    "38247840" => "38276300",
    "38247840" => "38276400",
    "38247840" => "38276500",
    "38247880" => "38275100",
    "38247880" => "38275900",
    "38247880" => "38276100",
    "38247880" => "38276300",
    "38247880" => "38276500",
    "38247880" => "38276800",
    "38247880" => "38276900",
    "38247890" => "38275100",
    "38247890" => "38275900",
    "38247890" => "38276100",
    "38247890" => "38276200",
    "38247890" => "38276300",
    "38247890" => "38276400",
    "38247890" => "38276500",
    "38247890" => "38276800",
    "38247890" => "38276900",
    "38247900" => "38279000",
    "38249956" => "24041200",
    "38249957" => "24041990",
    "38249958" => "24049200",
    "38249992" => "24041200",
    "38249992" => "24041990",
    "38249992" => "24049900",
    "38249992" => "38248900",
    "38249992" => "38249200",
    "38249992" => "38249992",
    "38249993" => "24041200",
    "38249993" => "24041990",
    "38249993" => "24049900",
    "38249993" => "38248900",
    "38249993" => "38249200",
    "38249993" => "38249993",
    "39072011" => "39072911",
    "39072020" => "39072100",
    "39072020" => "39072920",
    "39072091" => "39072991",
    "39072099" => "39072999",
    "39119099" => "39112000",
    "39119099" => "39119099",
    "40151100" => "40151200",
    "40151900" => "40151200",
    "40151900" => "40151900",
    "44013900" => "44013200",
    "44013900" => "44013900",
    "44014010" => "44014100",
    "44014090" => "44014900",
    "44029000" => "44022000",
    "44029000" => "44029000",
    "44034985" => "44034200",
    "44034985" => "44034985",
    "44071110" => "44071110",
    "44071110" => "44071300",
    "44071120" => "44071120",
    "44071120" => "44071300",
    "44071190" => "44071190",
    "44071190" => "44071300",
    "44071210" => "44071210",
    "44071210" => "44071300",
    "44071210" => "44071400",
    "44071220" => "44071220",
    "44071220" => "44071300",
    "44071220" => "44071400",
    "44071290" => "44071290",
    "44071290" => "44071300",
    "44071290" => "44071400",
    "44071910" => "44071300",
    "44071910" => "44071400",
    "44071910" => "44071910",
    "44071920" => "44071300",
    "44071920" => "44071400",
    "44071920" => "44071920",
    "44071990" => "44071300",
    "44071990" => "44071400",
    "44071990" => "44071990",
    "44072915" => "44072310",
    "44072915" => "44072915",
    "44072983" => "44072320",
    "44072983" => "44072983",
    "44072985" => "44072310",
    "44072985" => "44072985",
    "44072995" => "44072390",
    "44072995" => "44072995",
    "44111290" => "44111292",
    "44111290" => "44111294",
    "44111390" => "44111392",
    "44111390" => "44111394",
    "44111490" => "44111492",
    "44111490" => "44111495",
    "44111490" => "44111497",
    "44119310" => "44119300",
    "44119390" => "44119300",
    "44123300" => "44123310",
    "44123300" => "44123320",
    "44123300" => "44123330",
    "44123300" => "44123390",
    "44129410" => "44125110",
    "44129410" => "44125200",
    "44129490" => "44125190",
    "44129490" => "44125900",
    "44129930" => "44129110",
    "44129930" => "44129210",
    "44129930" => "44129910",
    "44129940" => "44124191",
    "44129940" => "44124200",
    "44129940" => "44129191",
    "44129940" => "44129290",
    "44129950" => "44124191",
    "44129950" => "44124200",
    "44129950" => "44129191",
    "44129950" => "44129290",
    "44129985" => "44124199",
    "44129985" => "44124900",
    "44129985" => "44129199",
    "44129985" => "44129290",
    "44129985" => "44129990",
    "44140010" => "44141010",
    "44140090" => "44141090",
    "44140090" => "44149000",
    "44181010" => "44181100",
    "44181050" => "44181950",
    "44181090" => "44181100",
    "44181090" => "44181990",
    "44182010" => "44182110",
    "44182050" => "44182950",
    "44182080" => "44182190",
    "44182080" => "44182980",
    "44186000" => "44183000",
    "44186000" => "44188100",
    "44186000" => "44188200",
    "44186000" => "44188300",
    "44186000" => "44188900",
    "44189100" => "44188100",
    "44189100" => "44188200",
    "44189100" => "44188300",
    "44189100" => "44188900",
    "44189100" => "44189100",
    "44189910" => "44188100",
    "44189990" => "44188200",
    "44189990" => "44188300",
    "44189990" => "44188900",
    "44189990" => "44189200",
    "44189990" => "44189900",
    "44199010" => "44192010",
    "44199090" => "44192090",
    "44199090" => "44199000",
    "44201011" => "44201110",
    "44201019" => "44201190",
    "44201019" => "44201900",
    "44219100" => "44212000",
    "44219100" => "44219100",
    "44219991" => "44212000",
    "49051000" => "49059000",
    "49059100" => "49052000",
    "49059900" => "49059000",
    "55011000" => "55011100",
    "55011000" => "55011900",
    "57032012" => "57032910",
    "57032018" => "57032919",
    "57032092" => "57032991",
    "57032098" => "57032100",
    "57032098" => "57032999",
    "57033012" => "57033910",
    "57033018" => "57033100",
    "57033018" => "57033919",
    "57033082" => "57033991",
    "57033088" => "57033100",
    "57033088" => "57033999",
    "58021100" => "58021000",
    "58021900" => "58021000",
    "61161020" => "61161020",
    "61161080" => "61161080",
    "61169100" => "61161020",
    "61169100" => "61161080",
    "61169100" => "61169100",
    "61169200" => "61161020",
    "61169200" => "61161080",
    "61169200" => "61169200",
    "61169300" => "61161020",
    "61169300" => "61161080",
    "61169300" => "61169300",
    "61169900" => "61161020",
    "61169900" => "61161080",
    "61169900" => "61169900",
    "62011100" => "62012000",
    "62011210" => "62013010",
    "62011290" => "62013090",
    "62011310" => "62014010",
    "62011390" => "62014090",
    "62011900" => "62019000",
    "62019100" => "62012000",
    "62019200" => "62013010",
    "62019200" => "62013090",
    "62019300" => "62014010",
    "62019300" => "62014090",
    "62019900" => "62019000",
    "62021100" => "62022000",
    "62021210" => "62023010",
    "62021290" => "62023090",
    "62021310" => "62024010",
    "62021390" => "62024090",
    "62021900" => "62029000",
    "62029100" => "62022000",
    "62029200" => "62023010",
    "62029200" => "62023090",
    "62029300" => "62024010",
    "62029300" => "62024090",
    "62029900" => "62029000",
    "62102000" => "62102000",
    "62103000" => "62103000",
    "62104000" => "62102000",
    "62104000" => "62104000",
    "62105000" => "62103000",
    "62105000" => "62105000",
    "68129200" => "68129990",
    "68129300" => "68129990",
    "68129990" => "68129990",
    "68151010" => "68151100",
    "68151010" => "68151200",
    "68151010" => "68151300",
    "68151090" => "68151900",
    "68159100" => "68159100",
    "68159900" => "68159100",
    "68159900" => "68159900",
    "70010010" => "70010010",
    "70191910" => "70191300",
    "70191910" => "70191900",
    "70191990" => "70191300",
    "70191990" => "70191900",
    "70193100" => "70191400",
    "70193100" => "70191500",
    "70193200" => "70197100",
    "70193900" => "70196200",
    "70193900" => "70196910",
    "70193900" => "70197200",
    "70193900" => "70197300",
    "70193900" => "70198010",
    "70193900" => "70199000",
    "70194000" => "70196100",
    "70194000" => "70196500",
    "70194000" => "70196600",
    "70194000" => "70199000",
    "70195100" => "70196300",
    "70195100" => "70196400",
    "70195100" => "70196500",
    "70195100" => "70196990",
    "70195100" => "70199000",
    "70195200" => "70196300",
    "70195200" => "70196400",
    "70195200" => "70196600",
    "70195200" => "70199000",
    "70195900" => "70196300",
    "70195900" => "70196400",
    "70195900" => "70196600",
    "70195900" => "70196990",
    "70195900" => "70199000",
    "70199000" => "70196990",
    "70199000" => "70198090",
    "70199000" => "70199000",
    "71042010" => "71042100",
    "71042090" => "71042900",
    "71049010" => "71049100",
    "71049090" => "71049900",
    "71129100" => "71129100",
    "71129100" => "85492100",
    "71129100" => "85492900",
    "71129200" => "71129200",
    "71129200" => "85492100",
    "71129200" => "85492900",
    "71129900" => "71129900",
    "71129900" => "85492100",
    "71129900" => "85492900",
    "73043910" => "73043982",
    "73043910" => "73043983",
    "73043910" => "73043988",
    "73043952" => "73043950",
    "73043958" => "73043950",
    "73043992" => "73043982",
    "73043993" => "73043983",
    "73043998" => "73043988",
    "73044910" => "73044983",
    "73044910" => "73044985",
    "73044910" => "73044989",
    "73044993" => "73044983",
    "73044995" => "73044985",
    "73044999" => "73044989",
    "73045112" => "73045110",
    "73045118" => "73045110",
    "73045910" => "73045982",
    "73045910" => "73045983",
    "73045910" => "73045989",
    "73045932" => "73045930",
    "73045938" => "73045930",
    "73045992" => "73045982",
    "73045993" => "73045983",
    "73045999" => "73045989",
    "73061110" => "73061100",
    "73061190" => "73061100",
    "73061910" => "73061900",
    "73061990" => "73061900",
    "73063011" => "73063012",
    "73063011" => "73063018",
    "73063019" => "73063012",
    "73063019" => "73063018",
    "73065020" => "73065021",
    "73065020" => "73065029",
    "74191000" => "74192000",
    "74191000" => "74198090",
    "74199100" => "74192000",
    "74199910" => "74198010",
    "74199930" => "74198030",
    "74199990" => "74198090",
    "76061110" => "76061130",
    "76061110" => "76061150",
    "76061191" => "76061130",
    "76061191" => "76061191",
    "76061193" => "76061130",
    "76061193" => "76061193",
    "76061199" => "76061130",
    "76061199" => "76061199",
    "76061220" => "76061230",
    "76061220" => "76061250",
    "76061292" => "76061230",
    "76061292" => "76061292",
    "76061293" => "76061230",
    "76061293" => "76061293",
    "76061299" => "76061230",
    "76061299" => "76061299",
    "76072090" => "76072091",
    "76072090" => "76072099",
    "81039010" => "81039910",
    "81039090" => "81039100",
    "81039090" => "81039990",
    "81060010" => "81061010",
    "81060010" => "81069010",
    "81060090" => "81061090",
    "81060090" => "81069090",
    "81072000" => "81126910",
    "81073000" => "81126100",
    "81079000" => "81126990",
    "81092000" => "81092100",
    "81092000" => "81092900",
    "81093000" => "81093100",
    "81093000" => "81093900",
    "81099000" => "81099100",
    "81099000" => "81099900",
    "81129210" => "81123100",
    "81129221" => "81124110",
    "81129221" => "81129221",
    "81129231" => "81124190",
    "81129231" => "81129240",
    "81129920" => "81123900",
    "81129920" => "81129940",
    "81129930" => "81124900",
    "81129930" => "81129950",
    "84146000" => "84146000",
    "84146000" => "84147000",
    "84148080" => "84147000",
    "84148080" => "84148080",
    "84149000" => "84149000",
    "84181020" => "84181020",
    "84181080" => "84181080",
    "84185011" => "84181020",
    "84185011" => "84181080",
    "84185011" => "84185011",
    "84185019" => "84181020",
    "84185019" => "84181080",
    "84185019" => "84185019",
    "84185090" => "84181020",
    "84185090" => "84181080",
    "84185090" => "84185090",
    "84191900" => "84191200",
    "84191900" => "84191900",
    "84193100" => "84193300",
    "84193100" => "84193400",
    "84193200" => "84193300",
    "84193200" => "84193500",
    "84193900" => "84193300",
    "84193900" => "84193900",
    "84213935" => "84213200",
    "84213935" => "84213935",
    "84213985" => "84147000",
    "84213985" => "84213200",
    "84213985" => "84213985",
    "84219990" => "84149000",
    "84219990" => "84219990",
    "84289090" => "84287000",
    "84289090" => "84289090",
    "84388099" => "84388099",
    "84388099" => "84792000",
    "84418000" => "84418000",
    "84418000" => "84858000",
    "84621010" => "84621110",
    "84621010" => "84621910",
    "84621010" => "84625100",
    "84621010" => "84626110",
    "84621010" => "84626210",
    "84621010" => "84626310",
    "84621010" => "84626910",
    "84621010" => "84629010",
    "84621090" => "84621190",
    "84621090" => "84621990",
    "84621090" => "84625900",
    "84621090" => "84626190",
    "84621090" => "84626290",
    "84621090" => "84626390",
    "84621090" => "84626990",
    "84621090" => "84629090",
    "84622110" => "84622210",
    "84622110" => "84622300",
    "84622110" => "84622400",
    "84622110" => "84622500",
    "84622110" => "84622600",
    "84622110" => "84622910",
    "84622110" => "84626110",
    "84622110" => "84626210",
    "84622110" => "84626310",
    "84622110" => "84626910",
    "84622110" => "84629010",
    "84622180" => "84622600",
    "84622180" => "84625100",
    "84622180" => "84626110",
    "84622180" => "84626210",
    "84622180" => "84626310",
    "84622180" => "84626910",
    "84622180" => "84629010",
    "84622910" => "84622290",
    "84622910" => "84622990",
    "84622910" => "84626190",
    "84622910" => "84626290",
    "84622910" => "84626390",
    "84622910" => "84626990",
    "84622910" => "84629090",
    "84622991" => "84625900",
    "84622991" => "84626190",
    "84622991" => "84629090",
    "84622998" => "84625900",
    "84622998" => "84626290",
    "84622998" => "84626390",
    "84622998" => "84626990",
    "84622998" => "84629090",
    "84623100" => "84623210",
    "84623100" => "84623300",
    "84623100" => "84625100",
    "84623100" => "84626110",
    "84623100" => "84626210",
    "84623100" => "84626310",
    "84623100" => "84626910",
    "84623100" => "84629010",
    "84623910" => "84623290",
    "84623910" => "84623900",
    "84623910" => "84626190",
    "84623910" => "84626290",
    "84623910" => "84626390",
    "84623910" => "84626990",
    "84623910" => "84629090",
    "84623991" => "84625900",
    "84623991" => "84626190",
    "84623991" => "84629090",
    "84623999" => "84625900",
    "84623999" => "84626290",
    "84623999" => "84626390",
    "84623999" => "84626990",
    "84623999" => "84629090",
    "84624110" => "84624200",
    "84624110" => "84626110",
    "84624110" => "84626210",
    "84624110" => "84626310",
    "84624110" => "84626910",
    "84624110" => "84629010",
    "84624190" => "84625100",
    "84624190" => "84626110",
    "84624190" => "84626210",
    "84624190" => "84626310",
    "84624190" => "84626910",
    "84624190" => "84629010",
    "84624910" => "84624900",
    "84624910" => "84626190",
    "84624910" => "84626290",
    "84624910" => "84626390",
    "84624910" => "84626990",
    "84624910" => "84629090",
    "84624990" => "84625900",
    "84624990" => "84626190",
    "84624990" => "84626290",
    "84624990" => "84626390",
    "84624990" => "84626990",
    "84624990" => "84629090",
    "84629120" => "84626110",
    "84629120" => "84629010",
    "84629180" => "84626190",
    "84629180" => "84629090",
    "84629920" => "84624200",
    "84629920" => "84626210",
    "84629920" => "84626310",
    "84629920" => "84626910",
    "84629920" => "84629010",
    "84629980" => "84624900",
    "84629980" => "84626290",
    "84629980" => "84626390",
    "84629980" => "84626990",
    "84629980" => "84629090",
    "84639000" => "84639000",
    "84639000" => "84851000",
    "84659900" => "84659900",
    "84659900" => "84858000",
    "84669400" => "84669400",
    "84669400" => "84859090",
    "84748090" => "84748090",
    "84748090" => "84853010",
    "84749090" => "84749090",
    "84749090" => "84859010",
    "84752900" => "84752900",
    "84752900" => "84853090",
    "84759090" => "84759090",
    "84759090" => "84859090",
    "84778099" => "84778099",
    "84778099" => "84852000",
    "84779010" => "84779010",
    "84779010" => "84859090",
    "84779080" => "84779080",
    "84779080" => "84859090",
    "84792000" => "84792000",
    "84798100" => "84798100",
    "84798100" => "84798300",
    "84798997" => "84798300",
    "84798997" => "84798997",
    "84798997" => "84853090",
    "84798997" => "84858000",
    "84799020" => "84799020",
    "84799020" => "84859090",
    "84799070" => "84799070",
    "84799070" => "84859090",
    "85013100" => "85013100",
    "85013100" => "85017100",
    "85013100" => "85017200",
    "85013200" => "85013200",
    "85013200" => "85017200",
    "85013300" => "85013300",
    "85013300" => "85017200",
    "85013400" => "85013400",
    "85013400" => "85017200",
    "85016120" => "85016120",
    "85016120" => "85018000",
    "85016180" => "85016180",
    "85016180" => "85018000",
    "85016200" => "85016200",
    "85016200" => "85018000",
    "85016300" => "85016300",
    "85016300" => "85018000",
    "85016400" => "85016400",
    "85016400" => "85018000",
    "85074000" => "85078000",
    "85078000" => "85078000",
    "85141010" => "85141910",
    "85141080" => "85141100",
    "85141080" => "85141980",
    "85143020" => "85143110",
    "85143020" => "85143210",
    "85143020" => "85143910",
    "85143080" => "85143190",
    "85143080" => "85143290",
    "85143080" => "85143990",
    "85171200" => "85171300",
    "85171200" => "85171400",
    "85177000" => "85177100",
    "85177000" => "85177900",
    "85195000" => "85198100",
    "85198100" => "85198100",
    "85258011" => "85258100",
    "85258011" => "85258200",
    "85258011" => "85258300",
    "85258011" => "85258900",
    "85258019" => "85258100",
    "85258019" => "85258200",
    "85258019" => "85258300",
    "85258019" => "85258900",
    "85258019" => "88062110",
    "85258019" => "88062210",
    "85258030" => "85258100",
    "85258030" => "85258200",
    "85258030" => "85258300",
    "85258030" => "85258900",
    "85258030" => "88062110",
    "85258030" => "88062210",
    "85258091" => "85258100",
    "85258091" => "85258200",
    "85258091" => "85258300",
    "85258091" => "85258900",
    "85258091" => "88062110",
    "85258091" => "88062210",
    "85258099" => "85258100",
    "85258099" => "85258200",
    "85258099" => "85258300",
    "85258099" => "85258900",
    "85258099" => "88062110",
    "85258099" => "88062210",
    "85299041" => "85299040",
    "85299049" => "85299040",
    "85395000" => "85395200",
    "85399090" => "85395100",
    "85399090" => "85399090",
    "85414010" => "85414100",
    "85414090" => "85414200",
    "85414090" => "85414300",
    "85414090" => "85414900",
    "85415000" => "85415100",
    "85415000" => "85415900",
    "85437070" => "85434000",
    "85437090" => "85395100",
    "85437090" => "85434000",
    "85437090" => "85437090",
    "85439000" => "85399090",
    "85439000" => "85439000",
    "85481010" => "85491210",
    "85481010" => "85491310",
    "85481010" => "85491410",
    "85481010" => "85491910",
    "85481021" => "85491110",
    "85481029" => "85491220",
    "85481029" => "85491320",
    "85481029" => "85491420",
    "85481029" => "85491920",
    "85481091" => "85491190",
    "85481091" => "85491290",
    "85481099" => "85491290",
    "85481099" => "85491390",
    "85481099" => "85491490",
    "85481099" => "85491990",
    "85489020" => "85480020",
    "85489030" => "85480030",
    "85489090" => "85480090",
    "87012010" => "87012110",
    "87012010" => "87012210",
    "87012010" => "87012310",
    "87012010" => "87012410",
    "87012010" => "87012900",
    "87012090" => "87012190",
    "87012090" => "87012290",
    "87012090" => "87012390",
    "87012090" => "87012490",
    "87012090" => "87012900",
    "87042110" => "87042110",
    "87042110" => "87044110",
    "87042131" => "87042131",
    "87042131" => "87044131",
    "87042139" => "87042139",
    "87042139" => "87044139",
    "87042191" => "87042191",
    "87042191" => "87044191",
    "87042199" => "87042199",
    "87042199" => "87044199",
    "87042210" => "87042210",
    "87042210" => "87044210",
    "87042291" => "87042291",
    "87042291" => "87044291",
    "87042299" => "87042299",
    "87042299" => "87044299",
    "87042310" => "87042310",
    "87042310" => "87044310",
    "87042391" => "87042391",
    "87042391" => "87044391",
    "87042399" => "87042399",
    "87042399" => "87044399",
    "87043110" => "87043110",
    "87043110" => "87045110",
    "87043131" => "87043131",
    "87043131" => "87045131",
    "87043139" => "87043139",
    "87043139" => "87045139",
    "87043191" => "87043191",
    "87043191" => "87045191",
    "87043199" => "87043199",
    "87043199" => "87045199",
    "87043210" => "87043210",
    "87043210" => "87045210",
    "87043291" => "87043291",
    "87043291" => "87045291",
    "87043299" => "87043299",
    "87043299" => "87045299",
    "87049000" => "87046000",
    "87049000" => "87049000",
    "87082910" => "87082210",
    "87082910" => "87082910",
    "87082990" => "87082290",
    "87082990" => "87082990",
    "88021100" => "88021100",
    "88021100" => "88061010",
    "88021100" => "88062190",
    "88021100" => "88062290",
    "88021100" => "88062300",
    "88021100" => "88062400",
    "88021100" => "88062910",
    "88021100" => "88069100",
    "88021100" => "88069200",
    "88021100" => "88069300",
    "88021100" => "88069400",
    "88021100" => "88069910",
    "88021200" => "88021200",
    "88021200" => "88061090",
    "88021200" => "88062920",
    "88021200" => "88069920",
    "88022000" => "88022000",
    "88022000" => "88061010",
    "88022000" => "88062190",
    "88022000" => "88062290",
    "88022000" => "88062400",
    "88022000" => "88062910",
    "88022000" => "88069100",
    "88022000" => "88069200",
    "88022000" => "88069910",
    "88023000" => "88023000",
    "88023000" => "88061090",
    "88023000" => "88062920",
    "88023000" => "88069920",
    "88024000" => "88024000",
    "88024000" => "88061090",
    "88024000" => "88062920",
    "88024000" => "88069920",
    "88031000" => "88071000",
    "88032000" => "88072000",
    "88033000" => "88073000",
    "88039010" => "88079010",
    "88039021" => "88079021",
    "88039029" => "88079029",
    "88039030" => "88079030",
    "88039090" => "88079090",
    "89031010" => "89031100",
    "89031010" => "89031200",
    "89031090" => "89031900",
    "89039110" => "89032210",
    "89039110" => "89032310",
    "89039190" => "89032100",
    "89039190" => "89032290",
    "89039190" => "89032390",
    "89039210" => "89033210",
    "89039210" => "89033310",
    "89039291" => "89033100",
    "89039299" => "89033290",
    "89039299" => "89033390",
    "89039910" => "89039310",
    "89039910" => "89039910",
    "89039991" => "89039390",
    "90065100" => "90065380",
    "90065100" => "90065900",
    "90065200" => "90065900",
    "90065380" => "90065380",
    "90065900" => "90065900",
    "90138020" => "85241100",
    "90138020" => "85249100",
    "90138030" => "85241100",
    "90138030" => "85249100",
    "90138090" => "90138000",
    "90139010" => "85299018",
    "90189084" => "90189084",
    "90189084" => "90222100",
    "90189084" => "90222900",
    "90222100" => "90222100",
    "90222900" => "90222900",
    "90278005" => "90278910",
    "90278020" => "90278930",
    "90278080" => "90278100",
    "90278080" => "90278990",
    "91141000" => "91149010",
    "91149000" => "91149090",
    "94013000" => "94013100",
    "94013000" => "94013900",
    "94014000" => "94014100",
    "94014000" => "94014900",
    "94019010" => "94019110",
    "94019010" => "94019910",
    "94019030" => "94019190",
    "94019080" => "94019990",
    "94039010" => "94039910",
    "94039030" => "94039100",
    "94039090" => "94039990",
    "94049010" => "94044010",
    "94049010" => "94049010",
    "94049090" => "94044090",
    "94049090" => "94049090",
    "94051021" => "94051940",
    "94051040" => "85395100",
    "94051040" => "94051140",
    "94051040" => "94051940",
    "94051050" => "85395100",
    "94051050" => "94051150",
    "94051050" => "94051950",
    "94051091" => "94051990",
    "94051098" => "85395100",
    "94051098" => "94051190",
    "94051098" => "94051990",
    "94052011" => "94052940",
    "94052040" => "85395100",
    "94052040" => "94052140",
    "94052040" => "94052940",
    "94052050" => "85395100",
    "94052050" => "94052150",
    "94052050" => "94052950",
    "94052091" => "94052990",
    "94052099" => "85395100",
    "94052099" => "94052190",
    "94052099" => "94052990",
    "94053000" => "85395100",
    "94053000" => "94053100",
    "94053000" => "94053900",
    "94054010" => "85395100",
    "94054010" => "94054110",
    "94054010" => "94054210",
    "94054010" => "94054910",
    "94054031" => "94054940",
    "94054035" => "94054940",
    "94054039" => "85395100",
    "94054039" => "94054131",
    "94054039" => "94054231",
    "94054039" => "94054940",
    "94054091" => "94054990",
    "94054095" => "94054990",
    "94054099" => "85395100",
    "94054099" => "94054139",
    "94054099" => "94054239",
    "94054099" => "94054990",
    "94056020" => "94056120",
    "94056020" => "94056920",
    "94056080" => "94056180",
    "94056080" => "94056980",
    "94059900" => "85399090",
    "94059900" => "94059900",
    "94069038" => "94062000",
    "94069038" => "94069038",
    "95089000" => "95082100",
    "95089000" => "95082200",
    "95089000" => "95082300",
    "95089000" => "95082400",
    "95089000" => "95082500",
    "95089000" => "95082600",
    "95089000" => "95082900",
    "95089000" => "95083000",
    "95089000" => "95084000",
    "97011000" => "97012100",
    "97011000" => "97019100",
    "97019000" => "97012200",
    "97019000" => "97012900",
    "97019000" => "97019200",
    "97019000" => "97019900",
    "97020000" => "97021000",
    "97020000" => "97029000",
    "97030000" => "97031000",
    "97030000" => "97039000",
    "97050000" => "97051000",
    "97050000" => "97052100",
    "97050000" => "97052200",
    "97050000" => "97052900",
    "97050000" => "97053100",
    "97050000" => "97053900",
    "97060000" => "97061000",
    "97060000" => "97069000",
  );

  echo t("Päivitetään muuttuneet tullinimikkeet tuotteille")."...<br>";

  foreach ($muunnosavaimet as $vanha => $uusi) {
    $query  = "UPDATE tuote set
               tullinimike1     = '$uusi'
               WHERE yhtio      = '$kukarow[yhtio]'
               AND tullinimike1 = '$vanha'";
    $result = pupe_query($query);
  }

  // Eka rivi roskikseen
  unset($nimikeet[0]);

  echo t("Lisätään uudet tullinimikkeet tietokantaan")."...<br>";

  foreach ($nimikeet as $rivi) {
    list($cnkey, $cn, $dashes, $dm, $su, $su_vientiilmo, $kieli) = explode("\t", trim($rivi));

    $dm = preg_replace("/([^A-Z0-9öäåÅÄÖ \.,\-_\:\/\!\|\?\+\(\)%#]|é)/i", "", $dm);

    $query  = "INSERT INTO tullinimike SET
               yhtio         = '$kukarow[yhtio]',
               cnkey         = '$cnkey',
               cn            = '$cn',
               dashes        = '$dashes',
               dm            = '$dm',
               su            = '$su',
               su_vientiilmo = '$su_vientiilmo',
               kieli         = '$kieli',
               laatija       = '$kukarow[kuka]',
               luontiaika    = now()";
    $result = pupe_query($query);
  }

  echo t("Päivitys valmis")."...<br><br><hr>";
}


echo "<br><form method='post' autocomplete='off'>";
echo t("Listaa ja muokkaa tuotteiden tullinimikkeitä").":<br><br>";
echo "<table>";
echo "<tr>";
echo "<th>".t("Syötä tullinimike").":</th>";
echo "<td><input type='text' name='tullinimike1' value='$tullinimike1'></td>";
echo "</tr><tr>";
echo "<th>".t("Syötä tullinimikkeen lisäosa").":</th>";
echo "<td><input type='text' name='tullinimike2' value='$tullinimike2'> (ei pakollinen) </td>";
echo "<td class='back'><input type='submit' class='hae_btn' value='".t("Hae")."'></td>";
echo "</tr></table>";
echo "</form><br><br>";

echo "<form method='post' autocomplete='off'>";
echo "<input type='hidden' name='tee' value='synkronoi'>";
echo t("Päivitä järjestelmän tullinimiketietokanta").":<br><br>";
echo "<table>";
echo "<th>".t("Nouda uusimmat tullinimikkeet").":</th>";
echo "<td><input type='submit' value='".t("Nouda")."'></td>";
echo "</tr></table>";
echo "</form>";


if ($tullinimike1 != "") {

  if ($tullinimike2 != "") $lisa = " and tullinimike2='$tullinimike2'";
  else $lisa = "";

  $query = "SELECT *
            from tuote use index (yhtio_tullinimike)
            where yhtio      = '$kukarow[yhtio]'
            and tullinimike1 = '$tullinimike1' $lisa
            order by tuoteno";
  $resul = pupe_query($query);

  if (mysql_num_rows($resul) == 0) {
    echo "<font class='error'>Yhtään tuotetta ei löytynyt!</font><br>";
  }
  else {

    echo sprintf("<font class='message'>Haulla löytyi %s tuotetta.</font><br><br>", mysql_num_rows($resul));

    echo "<form method='post' autocomplete='off'>";
    echo "<input type='hidden' name='tullinimike1' value='$tullinimike1'>";
    echo "<input type='hidden' name='tullinimike2' value='$tullinimike2'>";
    echo "<input type='hidden' name='tee' value='muuta'>";

    echo "<table>";
    echo "<tr>";
    echo "<th>".t("Syötä uusi tullinimike").":</th>";
    echo "<td><input type='text' name='uusitullinimike1' value='$uusitullinimike1'></td>";
    echo "</tr><tr>";
    echo "<th>".t("Syötä tullinimikkeen lisäosa").":</th>";
    echo "<td><input type='text' name='uusitullinimike2' value='$uusitullinimike2'></td>";
    echo "<td class='back'><input type='submit' value='".t("Päivitä")."'></td>";
    echo "</tr></table>";
    echo "</form><br>";

    echo "<table>";
    echo "<tr>";
    echo "<th>".t("Tuoteno")."</th>";
    echo "<th>".t("Osasto")."</th>";
    echo "<th>".t("Try")."</th>";
    echo "<th>".t("Merkki")."</th>";
    echo "<th>".t("Nimitys")."</th>";
    echo "<th>".t("Tullinimike")."</th>";
    echo "<th>".t("Tullinimikkeen lisäosa")."</th>";
    echo "</tr>";

    while ($rivi = mysql_fetch_array($resul)) {

      // tehdään avainsana query
      $oresult = t_avainsana("OSASTO", "", "and avainsana.selite ='$rivi[osasto]'");
      $os = mysql_fetch_array($oresult);

      // tehdään avainsana query
      $tresult = t_avainsana("TRY", "", "and avainsana.selite ='$rivi[try]'");
      $try = mysql_fetch_array($tresult);

      echo "<tr>";
      echo "<td><a href='yllapito.php?toim=tuote&tunnus=$rivi[tunnus]&lopetus=tullinimikkeet.php'>$rivi[tuoteno]</a></td>";
      echo "<td>$rivi[osasto] $os[selitetark]</td>";
      echo "<td>$rivi[try] $try[selitetark]</td>";
      echo "<td>$rivi[tuotemerkki]</td>";
      echo "<td>".t_tuotteen_avainsanat($rivi, 'nimitys')."</td>";
      echo "<td>$rivi[tullinimike1]</td>";
      echo "<td>$rivi[tullinimike2]</td>";
      echo "</tr>";
    }
    echo "</table>";
  }
}

require "inc/footer.inc";
